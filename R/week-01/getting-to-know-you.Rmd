---
title: "Getting To Know You: An Exploratory Data Analysis"
author: "Joseph T. Ornstein ^[University of Georgia]"
date: "August 18, 2021"
output: 
  pdf_document:
    number_sections: true
abstract: "At the beginning of most graduate-level courses, participants take a few moments to get to know one another before diving into the course content. This paper asks: why not do both? In a series of analyses, we simultaneously get to know a bit more about the participants in POLS 7012, while introducing some of the foundational statistical tools we'll be learning this semester."
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.height = 2.5, fig.width = 4) # this line tells R not to include any code, errors, or warning messages in the knitted text itself

# load libraries
library(tidyverse) # so many useful functions!
library(here) # functions for file management
library(janitor) # functions for tidying up datasets
library(zipcodeR) # functions for mapping zip codes
library(ggthemes) # for pleasant visualization themes
library(geosphere) # functions for geographic data
library(tidytext) # functions for text analysis
library(wordcloud) # for word clouds!
library(broom) # functions for tidying regression tables
```

```{r load data}
# load dataset
d <- read_csv(here('data/getting-to-know-you/students.csv')) %>% 
  # clean up variable names
  clean_names() %>%  
  # make zipcode a character for geocoding
  mutate(zipcode = as.character(hometown_zip_code_us)) %>%
  # if the zip code only has four digits, at a leading zero
  mutate(zipcode = if_else(nchar(zipcode) == 4, paste0('0', zipcode), zipcode)) %>%
  # clean up the cats/dogs and beach/mountain preference strings; anything with a "c" is cats, anything with a "b" is beaches
  mutate(cats_or_dogs = do_you_prefer_cats_or_dogs %>% 
           str_to_lower %>% 
           str_detect('c') %>% 
           if_else(. , 'Cats', 'Dogs'),
         beach_or_mountains = do_you_prefer_the_beach_or_the_mountains %>% 
           str_to_lower %>% 
           str_detect('b') %>% 
           if_else(. , 'Beach', 'Mountains'))

# geocode the zipcodes
zip_geocodes <- geocode_zip(d$zipcode)
d <- left_join(d, zip_geocodes, by = 'zipcode')

# if no zip code provided, check coordinates field
d <- d %>% 
  mutate(lng = if_else(is.na(lng), 
                       str_split(hometown_coordinates_if_you_dont_have_a_home_zip_code,
                                 pattern = ', ', simplify = TRUE)[,2] %>% 
                         as.numeric,
                       lng),
         lat = if_else(is.na(lat), 
                       str_split(hometown_coordinates_if_you_dont_have_a_home_zip_code,
                                 pattern = ', ', simplify = TRUE)[,1] %>% 
                         as.numeric,
                       lat),
         full_name = paste(first_name, last_name))

# give some variables shorter names
d <- d %>% 
  rename(height_inches = what_is_your_height_in_inches,
         comfort_with_math = how_comfortable_are_you_with_math,
         how_are_you_feeling = how_are_you_feeling_about_this_semester)
```

# Introduction

It is customary to begin journal articles with a section titled "Introduction", to indicate that the reader has arrived at the beginning of the paper. As the very purpose of this paper is to serve as an introduction to the course and your classmates, I see no reason to dispense with custom here. In the following section, I will present some statistics and visualizations describing the personal data we collected at the beginning of class.

## Where We're From

We know that political scientists come from a wide range of backgrounds.[^1] But the *geographic* diversity of the discipline is, to my knowledge, understudied. Let's investigate where this particular cohort of graduate students is coming from.

[^1]: For some recent statistics on diversity in political science, see @reid2019.

```{r map, fig.cap='A map of hometowns for students in POLS 7012'}
world_map <- map_data('world')
ggplot() + 
  geom_polygon(data = world_map,
               mapping = aes(x=long, y=lat, group = group),
               fill = 'lightgray', color = 'white', 
               alpha = 0.7, size = 0.5) +
  geom_point(data = d,
             mapping = aes(x=lng, y=lat), alpha = 0.7,
             color = '#BA0C2F') +
  # coord_map() +
  ggthemes::theme_map()
```

```{r compute distance, fig.cap = 'The distance of each student from their home town', fig.height=8, fig.width=8}
# compute distance to Athens
d$distance_to_athens_km <- distm(cbind(d$lng, d$lat), c(-83.36, 34) , fun = distHaversine)[,1] / 1000

d %>% 
  mutate(full_name = fct_reorder(full_name, -distance_to_athens_km)) %>% 
  ggplot() +
  geom_bar(mapping = aes(x=distance_to_athens_km, y = full_name,
                         fill = distance_to_athens_km),
          stat = 'identity', width = 0.4) +
  #scale_x_log10(label=scales::comma_format(accuracy = 1)) +
  scale_x_continuous(label = scales::comma_format(accuracy = 1)) +
  scale_y_discrete() +
  labs(x = 'Distance to Athens (km)', y = NULL) +
  theme_minimal() +
  guides(fill = 'none') +
  scale_fill_gradient(low = 'gray', high = '#BA0C2F')
```

The median student in POLS 7012 is `r median(d$distance_to_athens_km) %>% floor %>% prettyNum(big.mark = ',')` km from their hometown, but the *average* student is `r mean(d$distance_to_athens_km) %>% floor %>% prettyNum(big.mark = ',')` km from their hometown. A divergence between those two numbers suggests the presence of outliers and/or skew.

## Personal Characteristics

On average, we are `r floor(mean(d$height_inches) / 12)` feet, `r floor(mean(d$height_inches) %% 12)` inches tall. `r sum(d$cats_or_dogs == 'Dogs') / nrow(d) * 100 %>% floor`% of us prefer dogs over cats. `r sum(d$beach_or_mountains == 'Beach') / nrow(d) * 100 %>% floor`% of us prefer beaches over mountains. Here is one way to visualize all that information.

```{r personal-characteristics, fig.cap="Distribution of personal characteristics in POLS 7012. I don't know if this is the *best* way to plot this data, but it is one way.", fig.width=8, fig.height=5}
ggplot(data = d) +
  geom_point(mapping = aes(x=height_inches, y=comfort_with_math),
             alpha = 0.6) +
  facet_grid(cats_or_dogs ~ beach_or_mountains) +
  theme_bw() +
  labs(x = 'Height (inches)', y = 'Comfort With Math')
```

```{r height and math, fig.cap='Height and Math Comfort'}
# does height correlate with math comfort? model math comfort as a function of height
height_lm <- lm(comfort_with_math ~ height_inches, data = d)
slope <- round(height_lm$coefficients['height_inches'] * 12, 2)
pval <- tidy(height_lm)$p.value[2]
```

Here's an interesting correlation that shows up in the data: `r ifelse(slope >= 0, 'taller', 'shorter')` people seem to be more comfortable with math. On average, 1 additional foot of height is associated with `r slope` more points in math comfort. `r ifelse(pval < 0.1, 'And the correlation is quite strong.', 'However, the correlation appears to be quite weak.')` The probability that a relationship between two variables this strong could arise purely from chance is roughly `r round(pval * 100, 1)`%. One of the central challenges in quantitative social science is to think carefully about what processes could generate the patterns you observe in the data. (And no amount of mathematical wizardry will ever relieve you of the need for careful thinking.)

# Sentiment Analysis

```{r text-analysis}
d_words <- d %>% 
  # create a row for each word in `how_are_you_feeling`
  unnest_tokens(word, how_are_you_feeling) %>% 
  select(full_name, word) %>% 
  # remove the stop words (i.e. boring words)
  anti_join(get_stopwords()) %>% 
  left_join(get_sentiments('bing')) %>% 
  filter(!is.na(sentiment))

# let +1 be a positive sentiment, and -1 be a negative sentiment; get everyone's sum
people <- d_words %>% 
  mutate(sentiment = case_when(sentiment == 'positive' ~ 1,
                               sentiment == 'negative' ~ -1,
                               TRUE ~ 0)) %>% 
  group_by(full_name) %>% 
  summarize(sentiment_score = sum(sentiment))
```

Each participant was asked to write a short statement describing how they felt about taking a quantitative political methodology course. In total, `r sum(people$sentiment_score > 0)` `r if_else(sum(people$sentiment_score > 0) == 1, 'person expressed', 'people expressed')` more positive than negative feelings, `r sum(people$sentiment_score < 0)` `r if_else(sum(people$sentiment_score < 0) == 1, 'person expressed', 'people expressed')` more negative than positive feelings, and `r nrow(d) - nrow(people)` `r if_else(nrow(d) - nrow(people) == 1, 'person was', 'people were')` were somewhat neutral. It is not uncommon for students to feel anxious or uncertain -- many people have unpleasant associations with math [@strogatz2012], and for many of you, your last regular contact with the subject was in high school! During the semester, we'll discuss strategies to boost your confidence with math and coding, and I encourage you to lean on your cohort, senior grad students, and instructors for guidance and support.

```{r word-cloud, fig.cap = 'Word cloud with words expressing positve or negative sentiments', fig.height=8, fig.width=8}
# create word cloud
word_cloud_data <- d_words %>% 
  count(word) %>% 
  rename(freq = n)
wordcloud(words = word_cloud_data$word,
          freq = word_cloud_data$freq)
```

# References
