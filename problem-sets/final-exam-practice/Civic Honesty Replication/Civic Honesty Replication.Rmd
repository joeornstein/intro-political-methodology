---
title: Final Exam Practice
date: "`r format(Sys.Date(), '%B %d, %Y')`"
authors:
  - name: YOUR NAME HERE
    email: email@email.email
    address: University of Georgia
  - name: Joseph T. Ornstein
    email: jornstein@uga.edu
    address: University of Georgia

bibliography: refs.bib
output: rticles::oup_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE) # show the code, but not the warnings/errors
knitr::opts_chunk$set(fig.pos = 'p') # Places figures on pages separate from text
knitr::opts_chunk$set(out.width = '100%', dpi=300) # Figure resolution and size
knitr::opts_chunk$set(fig.env="figure") # Latex figure environment

# include packages here!
library(tidyverse)
```

# Introduction

In this paper, we will replicate the results from "Civic Honesty Around the Globe" [@cohnCivicHonestyGlobe2019]. Anything I call an "extra challenge" is available for the intrepid among you, but is not required.

To submit your final exam, knit this `.Rmd` to a PDF and post it to eLC.


# Data

Replication files are available [here](https://dataverse.harvard.edu/dataverse/honesty), and I have already downloaded them into the `data/` folder. Let's load the behavioral data.

```{r load data}
data <- read_csv('data/behavioral data (csv file).csv')
```


# Results


## Replicating Figure 1

First, let's replicate the left-hand side of Figure 1. To do so, we need to perform the following steps:

- Keep only the `Money` and `NoMoney` conditions.
- Recode the `cond` variable as "Money" and "NoMoney".
- Compute the average response rate, grouped by country and condition.
- Plot a scatter with reporting rate on the x-axis, country on the y-axis, and colored by monetary condition.  

As an extra challenge, you can:

- Rearrange the y-axis so that the countries with the lowest reporting rate appear at the bottom and those with the highest reporting rate appear at the top.
- Include the line segments between points from the original figure
- Use the colors from the original figure

```{r Figure 1, fig.cap='Share of wallets reported in the NoMoney and Money conditions, by country.'}
fig1 <- data %>% 
  filter(cond %in% c(0,1)) %>% 
  mutate(cond = case_when(cond == 1 ~ 'Money', 
                          cond == 0 ~ 'NoMoney')) %>% 
  # compute reporting rate by country and monetary condition
  group_by(Country,
           cond) %>% 
  summarize(pct_reported = mean(response)) %>%
  # plot
  ggplot() +
  geom_point(aes(x=pct_reported, y=Country, color = factor(cond))) +
  labs(x = 'Reporting rate (%)', y = '', color = 'Condition') +
  theme_minimal()

fig1


# Here's the challenging one
fig1a <- data %>% 
  filter(cond %in% c(0,1)) %>% 
  mutate(cond = case_when(cond == 1 ~ 'Money', 
                          cond == 0 ~ 'NoMoney')) %>% 
  # compute reporting rate by country and monetary condition
  group_by(Country,
           cond) %>% 
  summarize(pct_reported = mean(response)) %>%
  # pivot_wider to make those line segments
  ungroup %>% 
  pivot_wider(names_from = cond, values_from = pct_reported) %>% 
  # reorder Country by the NoMoney reporting rate 
  mutate(Country = fct_reorder(Country, NoMoney)) %>% 
  # compute label position, near minimum reporting rate
  mutate(label_position = pmin(Money, NoMoney) -
           nchar(as.character(Country))/3.5 - 1) %>% 
  # begin ggplot
  ggplot() +
  geom_segment(aes(x=Money, xend=NoMoney, y=Country, yend=Country),
               color = 'gray', size = 0.5) + 
  geom_point(aes(x=Money,y=Country), color = 'red') +
  geom_point(aes(x=NoMoney,y=Country), color = '#F6BE00') +
  geom_text(aes(x=label_position, y=Country, label = Country), size = 2) +
  labs(x = 'Reporting rate (%)', y = '', color = 'Condition') +
  theme_classic() +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.y = element_blank())
  
  

fig1a
```

# References
