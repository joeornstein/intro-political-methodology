<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Prediction</title>
    <meta charset="utf-8" />
    <link href="10-Prediction_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="10-Prediction_files/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Prediction

---


&lt;style&gt;

.center-middle {
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}

&lt;/style&gt;



## What Are Models?

A model is "low-dimensional" mathematical representation of the world. It takes all the messy, noisy complexity of a dataset and simplifies it. 

--

&lt;img src="10-Prediction_files/figure-html/unnamed-chunk-1-1.png" width="50%" style="display: block; margin: auto;" /&gt;

--

One way to think about statistical models is that they partition the data into **signal** and **noise**.

`$$Y = \underbrace{X\beta}_\text{signal} + \underbrace{\varepsilon}_\text{noise}$$`

???

If I've done my job right, then the noise is unrelated to the signal, the systematic relationships that I care about.


## Outline

What are models?

1. Abstracted mathematical representations of the dataset.

2. If done right, the relationships expressed in a model separate the "signal" (an interesting phenomenon or a reliable pattern that predicts your data) from the "noise" (randomness from sampling, measurement error, or a bunch of other things that are (hopefully) orthogonal to the topic you care about).

The goal of a model is not to uncover truth, but to discover a simple approximation that is still useful.



Observed data &amp; parameters. We fit the parameters using an *estimator*, just like we did with the linear model.



What are they good for?

1. Summarizing patterns and relationships in data (what we've been doing so far). Allows us to quantify the size and uncertainty of estimates.

2. Make predictions about unseen data.

3. Distinguish cause and effect; make **counterfactual** predictions.

Today #2, then #3. 

- Making predictions from an `lm()` model.
  - Prediction error
  - But it's not really a...prediction, is it?
- Split sample with CCES
  - `lm()` the feeling thermometer, maybe?
  
  
  
---

## Why Do We Model Data?

Broadly speaking, there are three reasons social scientists build models:

--

1. To **summarize** patterns and relationships, and to quantify our uncertainty.

--

  - This is what we've been doing so far.
  
--

2. To make **predictions** about unobserved data.

--

3. To distinguish between cause and effect; to make **counterfactual** predictions.

--

Today we discuss prediction. Next week, causal inference.

---

## Today's Objectives

By the end of this module, you will be able to...

- Make predictions using model objects in `R`

- Evaluate a model's predictive accuracy

- Cross-validate and regularize models to improve out-of-sample prediction

---

## Our Challenge Today

I want to try to **predict** how ANES survey respondents feel about journalists, using observable covariates. 


```r
# load the ANES pilot study
load('data/anes_pilot_2019.RData')

# recode some variables
data &lt;- data %&gt;% 
  mutate(age = 2019 - birthyr,
         female = as.numeric(gender == 2),
         race = case_when(race == 1 ~ 'White',
                          race == 2 ~ 'Black',
                          race == 3 ~ 'Hispanic',
                          TRUE ~ 'Other'),
         educ = case_when(educ == 1 ~ 'No HS',
                          educ == 2 ~ 'High school graduate',
                          educ == 3 ~ 'Some college',
                          educ == 4 ~ '2-year',
                          educ == 5 ~ '4-year',
                          educ == 6 ~ 'Post-grad'))

ftjournal_viz &lt;- ggplot(data) +
  geom_histogram(aes(x=ftjournal),color = 'black', binwidth = 7)
```

---

## Our Challenge Today


```r
ftjournal_viz
```

&lt;img src="10-Prediction_files/figure-html/viz ftjournal-1.png" width="600" style="display: block; margin: auto;" /&gt;

---

## Exercise

Estimate a linear model of `ftjournal` using observed characteristics of the respondents. What patterns do you observe?

--


```r
data &lt;- data %&gt;% 
  mutate(pew_religimp = case_when(pew_religimp == 1 ~ 'Very Important',
                                  pew_religimp == 2 ~ 'Somewhat Important',
                                  pew_religimp == 3 ~ 'Not too important',
                                  pew_religimp == 4 ~ 'Not at all important'),
         vote20jb = case_when(vote20jb == 1 ~ 'Trump Voter',
                              vote20jb == 2 ~ 'Biden Voter',
                              vote20jb == 3 ~ 'Other Voter',
                              vote20jb == 4 ~ 'Non-Voter'))

linear_model1 &lt;- lm(ftjournal ~ age + female + race + educ + pew_religimp + vote20jb, data = data)
```



---


```r
library(broom)

tidy(linear_model1)
```

```
# A tibble: 17 x 5
   term                           estimate std.error statistic   p.value
   &lt;chr&gt;                             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)                     75.6       2.37      32.0   1.99e-194
 2 age                             -0.0553    0.0268    -2.06  3.95e-  2
 3 female                           3.24      0.862      3.76  1.73e-  4
 4 raceHispanic                     1.11      1.84       0.605 5.45e-  1
 5 raceOther                       -4.47      2.04      -2.19  2.89e-  2
 6 raceWhite                        0.292     1.48       0.197 8.44e-  1
 7 educ4-year                       0.225     1.55       0.145 8.84e-  1
 8 educHigh school graduate        -1.27      1.45      -0.877 3.81e-  1
 9 educNo HS                       -0.919     2.40      -0.383 7.02e-  1
10 educPost-grad                    1.90      1.74       1.09  2.75e-  1
11 educSome college                -0.841     1.53      -0.551 5.82e-  1
12 pew_religimpNot too important   -2.59      1.40      -1.84  6.52e-  2
13 pew_religimpSomewhat Important  -3.14      1.27      -2.46  1.40e-  2
14 pew_religimpVery Important      -3.54      1.22      -2.89  3.85e-  3
15 vote20jbNon-Voter              -22.5       1.62     -13.9   8.16e- 43
16 vote20jbOther Voter            -20.0       1.50     -13.3   2.19e- 39
17 vote20jbTrump Voter            -44.1       1.05     -41.9   9.67e-305
```

???

So the model would predict that a 50 year old male Hispanic, high school graduate...

---

## Making Predictions

To make **predictions** using your model, use the `predict()` function!

  - The first input is a model object.
  - The second input is a dataframe that contains all the explantaory variables in your model.


```r
# create a new variable called ftjournal_prediction
data &lt;- data %&gt;% 
  mutate(ftjournal_prediction = predict(linear_model1, data))
```

---

## Making Predictions


| age| female|race     |educ                 |pew_religimp       |vote20jb    | ftjournal_prediction|
|---:|------:|:--------|:--------------------|:------------------|:-----------|--------------------:|
|  50|      0|Hispanic |High school graduate |Somewhat Important |Biden Voter |             69.54962|
|  77|      0|White    |Post-grad            |Very Important     |Trump Voter |             25.92024|
|  65|      1|White    |High school graduate |Very Important     |Biden Voter |             70.74225|
|  40|      0|Black    |Some college         |Very Important     |Trump Voter |             24.93350|
|  79|      1|White    |Post-grad            |Somewhat Important |Trump Voter |             29.44951|

---

## Quick Clarification 

Why did I recode those education and race variables? Why not just leave them as numbers? 

`lm()` needs to know whether to treat a variable as continuous or categorical. 
 - If the variable is numeric, it will treat it as continuous 
 - If it's a character, it will treat it as categorical
 
--

If we leave race coded as numeric, `lm()` will do this:

&lt;img src="10-Prediction_files/figure-html/old coding-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Model Selection

How do you decide which variables to include in your model? 

--

- It depends on the purpose of the model.

--

Why not **ALL THE VARIABLES**?

&lt;img src="img/piled-up-dishes-in-kitchen-sink.jpg" width="75%" style="display: block; margin: auto;" /&gt;

---



```r
# take 70% of the data as the "training set"
train &lt;- data %&gt;% 
  sample_frac(0.7)

# the test set is whatever is left over (use anti_join)
test &lt;- data %&gt;% 
  anti_join(train, by = 'caseid')
```

---

Now, we only train our models on the `train` set. Never on the `test` set! That's only for validation.


```r
lm1 &lt;- lm(ftjournal ~ age + female + educ + race, data = train)

summary(lm1)
```

```

Call:
lm(formula = ftjournal ~ age + female + educ + race, data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-68.187 -26.669   0.504  25.290  63.505 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               69.86494    3.35722  20.810  &lt; 2e-16 ***
age                       -0.20741    0.03988  -5.200 2.17e-07 ***
female                     5.95122    1.30435   4.563 5.33e-06 ***
educ4-year                 3.35757    2.37756   1.412 0.158035    
educHigh school graduate  -3.71667    2.22725  -1.669 0.095314 .  
educNo HS                 -3.63211    3.65253  -0.994 0.320133    
educPost-grad              9.07989    2.66293   3.410 0.000662 ***
educSome college          -0.58550    2.33021  -0.251 0.801634    
raceHispanic              -9.45011    2.81245  -3.360 0.000792 ***
raceOther                -20.75677    3.06357  -6.775 1.59e-11 ***
raceWhite                -14.24366    2.16653  -6.574 6.08e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 30.54 on 2205 degrees of freedom
Multiple R-squared:  0.06381,	Adjusted R-squared:  0.05956 
F-statistic: 15.03 on 10 and 2205 DF,  p-value: &lt; 2.2e-16
```
---

# Out-Of-Sample Prediction


```r
test &lt;- test %&gt;% 
  mutate(ftjournal_hat = predict(lm1, test))

ggplot(test) + 
  geom_point(aes(x=ftjournal_hat,y=ftjournal)) +
  labs(x='Predicted Feeling Thermometer (Journalists)', 
       y='Actual Feeling Thermometer (Journalists)') +
  geom_abline(intercept = 0, slope = 1, linetype = 'dotted')
```

&lt;img src="10-Prediction_files/figure-html/out-of-sample prediction-1.png" width="600" style="display: block; margin: auto;" /&gt;

---

Prediction error metrics

How would you compute mean squared error?

--


```r
mse &lt;- mean((test$ftjournal - test$ftjournal_hat)^2)

mse
```

```
[1] 960.8737
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
